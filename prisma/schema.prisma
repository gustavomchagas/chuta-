generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Player {
  id        String   @id @default(uuid())
  phone     String   @unique
  name      String
  isAdmin   Boolean  @default(false) @map("is_admin")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  bets Bet[]

  @@map("players")
}

model Group {
  id              String   @id @default(uuid())
  name            String
  whatsappGroupId String?  @unique @map("whatsapp_group_id")
  isActive        Boolean  @default(true) @map("is_active")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  matches Match[]

  @@map("groups")
}

model Match {
  id           String      @id @default(uuid())
  groupId      String?     @map("group_id")
  round        Int
  homeTeam     String      @map("home_team")
  awayTeam     String      @map("away_team")
  matchDate    DateTime    @map("match_date")
  homeScore    Int?        @map("home_score")
  awayScore    Int?        @map("away_score")
  status       MatchStatus @default(SCHEDULED)
  createdAt    DateTime    @default(now()) @map("created_at")
  updatedAt    DateTime    @updatedAt @map("updated_at")

  group Group? @relation(fields: [groupId], references: [id], onDelete: Cascade)
  bets  Bet[]

  @@map("matches")
}

enum MatchStatus {
  SCHEDULED
  LIVE
  FINISHED
  POSTPONED
  CANCELLED
}

model Bet {
  id             String   @id @default(uuid())
  playerId       String   @map("player_id")
  matchId        String   @map("match_id")
  homeScoreGuess Int      @map("home_score_guess")
  awayScoreGuess Int      @map("away_score_guess")
  points         Int?
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)
  match  Match  @relation(fields: [matchId], references: [id], onDelete: Cascade)

  @@unique([playerId, matchId])
  @@map("bets")
}

model Notification {
  id      String   @id @default(uuid())
  type    String   // MORNING_GAMES, REMINDER, etc
  groupId String?  @map("group_id")
  sentAt  DateTime @map("sent_at")
  
  @@map("notifications")
}